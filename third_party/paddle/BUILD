load("@rules_cc//cc:defs.bzl", "cc_import", "cc_library")

package(
    default_visibility = ["//visibility:public"],
)

config_setting(
    name = "paddle-link-static",
    values = {"define": "paddle_link_static=true"},
)

#TODO fix license label
licenses(["notice"])  # BSD

#paddle_inference
cc_import(
    name = "paddle_inference-static_lib",
    static_library = "paddle/lib/libpaddle_inference.a",
    #linkstatic = 1,
    visibility = ["//visibility:private"],
)

cc_import(
    name = "paddle_inference-shared_lib",
    shared_library = "paddle/lib/libpaddle_inference.so",
    visibility = ["//visibility:private"],
)

cc_library(
    name = "paddle_inference-lib",
    hdrs = [
        "paddle/include/crypto/cipher.h",
        "paddle/include/experimental/ext_all.h",
        "paddle/include/experimental/phi/api/all.h",
        "paddle/include/experimental/phi/api/ext/dispatch.h",
        "paddle/include/experimental/phi/api/ext/exception.h",
        "paddle/include/experimental/phi/api/ext/op_meta_info.h",
        "paddle/include/experimental/phi/api/ext/tensor_compat.h",
        "paddle/include/experimental/phi/api/include/api.h",
        "paddle/include/experimental/phi/api/include/context_pool.h",
        "paddle/include/experimental/phi/api/include/dll_decl.h",
        "paddle/include/experimental/phi/api/include/sparse_api.h",
        "paddle/include/experimental/phi/api/include/strings_api.h",
        "paddle/include/experimental/phi/api/include/tensor.h",
        "paddle/include/experimental/phi/common/amp_type_traits.h",
        "paddle/include/experimental/phi/common/backend.h",
        "paddle/include/experimental/phi/common/bfloat16.h",
        "paddle/include/experimental/phi/common/complex.h",
        "paddle/include/experimental/phi/common/cpstring_impl.h",
        "paddle/include/experimental/phi/common/data_type.h",
        "paddle/include/experimental/phi/common/float16.h",
        "paddle/include/experimental/phi/common/int_array.h",
        "paddle/include/experimental/phi/common/layout.h",
        "paddle/include/experimental/phi/common/place.h",
        "paddle/include/experimental/phi/common/pstring.h",
        "paddle/include/experimental/phi/common/scalar.h",
        "paddle/include/experimental/phi/common/type_traits.h",
        "paddle/include/experimental/phi/core/macros.h",
        "paddle/include/experimental/phi/core/visit_type.h",
        "paddle/include/experimental/utils/any.h",
        "paddle/include/experimental/utils/flat_hash_map.h",
        "paddle/include/experimental/utils/none.h",
        "paddle/include/experimental/utils/optional.h",
        "paddle/include/internal/framework.pb.h",
        "paddle/include/paddle_analysis_config.h",
        "paddle/include/paddle_api.h",
        "paddle/include/paddle_infer_contrib.h",
        "paddle/include/paddle_infer_declare.h",
        "paddle/include/paddle_inference_api.h",
        "paddle/include/paddle_mkldnn_quantizer_config.h",
        "paddle/include/paddle_pass_builder.h",
        "paddle/include/paddle_tensor.h",
    ],
    includes = ["paddle/include"],
    deps = select({
        ":paddle-link-static": [":paddle_inference-static_lib"],
        "//conditions:default": [":paddle_inference-shared_lib"],
    }),
)

#cryptopp
cc_library(
    name = "paddle_third_party_cryptopp",
    srcs = [
        "third_party/install/cryptopp/lib/libcryptopp.a",
    ],
    hdrs = [
        "third_party/install/cryptopp/include/cryptopp/3way.h",
        "third_party/install/cryptopp/include/cryptopp/adler32.h",
        "third_party/install/cryptopp/include/cryptopp/adv_simd.h",
        "third_party/install/cryptopp/include/cryptopp/aes.h",
        "third_party/install/cryptopp/include/cryptopp/aes_armv4.h",
        "third_party/install/cryptopp/include/cryptopp/algebra.h",
        "third_party/install/cryptopp/include/cryptopp/algparam.h",
        "third_party/install/cryptopp/include/cryptopp/arc4.h",
        "third_party/install/cryptopp/include/cryptopp/argnames.h",
        "third_party/install/cryptopp/include/cryptopp/aria.h",
        "third_party/install/cryptopp/include/cryptopp/arm_simd.h",
        "third_party/install/cryptopp/include/cryptopp/asn.h",
        "third_party/install/cryptopp/include/cryptopp/authenc.h",
        "third_party/install/cryptopp/include/cryptopp/base32.h",
        "third_party/install/cryptopp/include/cryptopp/base64.h",
        "third_party/install/cryptopp/include/cryptopp/basecode.h",
        "third_party/install/cryptopp/include/cryptopp/blake2.h",
        "third_party/install/cryptopp/include/cryptopp/blowfish.h",
        "third_party/install/cryptopp/include/cryptopp/blumshub.h",
        "third_party/install/cryptopp/include/cryptopp/camellia.h",
        "third_party/install/cryptopp/include/cryptopp/cast.h",
        "third_party/install/cryptopp/include/cryptopp/cbcmac.h",
        "third_party/install/cryptopp/include/cryptopp/ccm.h",
        "third_party/install/cryptopp/include/cryptopp/chacha.h",
        "third_party/install/cryptopp/include/cryptopp/chachapoly.h",
        "third_party/install/cryptopp/include/cryptopp/cham.h",
        "third_party/install/cryptopp/include/cryptopp/channels.h",
        "third_party/install/cryptopp/include/cryptopp/cmac.h",
        "third_party/install/cryptopp/include/cryptopp/config.h",
        "third_party/install/cryptopp/include/cryptopp/cpu.h",
        "third_party/install/cryptopp/include/cryptopp/crc.h",
        "third_party/install/cryptopp/include/cryptopp/cryptlib.h",
        "third_party/install/cryptopp/include/cryptopp/darn.h",
        "third_party/install/cryptopp/include/cryptopp/default.h",
        "third_party/install/cryptopp/include/cryptopp/des.h",
        "third_party/install/cryptopp/include/cryptopp/dh.h",
        "third_party/install/cryptopp/include/cryptopp/dh2.h",
        "third_party/install/cryptopp/include/cryptopp/dll.h",
        "third_party/install/cryptopp/include/cryptopp/dmac.h",
        "third_party/install/cryptopp/include/cryptopp/donna.h",
        "third_party/install/cryptopp/include/cryptopp/donna_32.h",
        "third_party/install/cryptopp/include/cryptopp/donna_64.h",
        "third_party/install/cryptopp/include/cryptopp/donna_sse.h",
        "third_party/install/cryptopp/include/cryptopp/drbg.h",
        "third_party/install/cryptopp/include/cryptopp/dsa.h",
        "third_party/install/cryptopp/include/cryptopp/eax.h",
        "third_party/install/cryptopp/include/cryptopp/ec2n.h",
        "third_party/install/cryptopp/include/cryptopp/eccrypto.h",
        "third_party/install/cryptopp/include/cryptopp/ecp.h",
        "third_party/install/cryptopp/include/cryptopp/ecpoint.h",
        "third_party/install/cryptopp/include/cryptopp/elgamal.h",
        "third_party/install/cryptopp/include/cryptopp/emsa2.h",
        "third_party/install/cryptopp/include/cryptopp/eprecomp.h",
        "third_party/install/cryptopp/include/cryptopp/esign.h",
        "third_party/install/cryptopp/include/cryptopp/factory.h",
        "third_party/install/cryptopp/include/cryptopp/fhmqv.h",
        "third_party/install/cryptopp/include/cryptopp/files.h",
        "third_party/install/cryptopp/include/cryptopp/filters.h",
        "third_party/install/cryptopp/include/cryptopp/fips140.h",
        "third_party/install/cryptopp/include/cryptopp/fltrimpl.h",
        "third_party/install/cryptopp/include/cryptopp/gcm.h",
        "third_party/install/cryptopp/include/cryptopp/gf256.h",
        "third_party/install/cryptopp/include/cryptopp/gf2_32.h",
        "third_party/install/cryptopp/include/cryptopp/gf2n.h",
        "third_party/install/cryptopp/include/cryptopp/gfpcrypt.h",
        "third_party/install/cryptopp/include/cryptopp/gost.h",
        "third_party/install/cryptopp/include/cryptopp/gzip.h",
        "third_party/install/cryptopp/include/cryptopp/hashfwd.h",
        "third_party/install/cryptopp/include/cryptopp/hc128.h",
        "third_party/install/cryptopp/include/cryptopp/hc256.h",
        "third_party/install/cryptopp/include/cryptopp/hex.h",
        "third_party/install/cryptopp/include/cryptopp/hight.h",
        "third_party/install/cryptopp/include/cryptopp/hkdf.h",
        "third_party/install/cryptopp/include/cryptopp/hmac.h",
        "third_party/install/cryptopp/include/cryptopp/hmqv.h",
        "third_party/install/cryptopp/include/cryptopp/hrtimer.h",
        "third_party/install/cryptopp/include/cryptopp/ida.h",
        "third_party/install/cryptopp/include/cryptopp/idea.h",
        "third_party/install/cryptopp/include/cryptopp/integer.h",
        "third_party/install/cryptopp/include/cryptopp/iterhash.h",
        "third_party/install/cryptopp/include/cryptopp/kalyna.h",
        "third_party/install/cryptopp/include/cryptopp/keccak.h",
        "third_party/install/cryptopp/include/cryptopp/lea.h",
        "third_party/install/cryptopp/include/cryptopp/lubyrack.h",
        "third_party/install/cryptopp/include/cryptopp/luc.h",
        "third_party/install/cryptopp/include/cryptopp/mars.h",
        "third_party/install/cryptopp/include/cryptopp/md2.h",
        "third_party/install/cryptopp/include/cryptopp/md4.h",
        "third_party/install/cryptopp/include/cryptopp/md5.h",
        "third_party/install/cryptopp/include/cryptopp/mdc.h",
        "third_party/install/cryptopp/include/cryptopp/mersenne.h",
        "third_party/install/cryptopp/include/cryptopp/misc.h",
        "third_party/install/cryptopp/include/cryptopp/modarith.h",
        "third_party/install/cryptopp/include/cryptopp/modes.h",
        "third_party/install/cryptopp/include/cryptopp/modexppc.h",
        "third_party/install/cryptopp/include/cryptopp/mqueue.h",
        "third_party/install/cryptopp/include/cryptopp/mqv.h",
        "third_party/install/cryptopp/include/cryptopp/naclite.h",
        "third_party/install/cryptopp/include/cryptopp/nbtheory.h",
        "third_party/install/cryptopp/include/cryptopp/nr.h",
        "third_party/install/cryptopp/include/cryptopp/oaep.h",
        "third_party/install/cryptopp/include/cryptopp/oids.h",
        "third_party/install/cryptopp/include/cryptopp/osrng.h",
        "third_party/install/cryptopp/include/cryptopp/ossig.h",
        "third_party/install/cryptopp/include/cryptopp/padlkrng.h",
        "third_party/install/cryptopp/include/cryptopp/panama.h",
        "third_party/install/cryptopp/include/cryptopp/pch.h",
        "third_party/install/cryptopp/include/cryptopp/pkcspad.h",
        "third_party/install/cryptopp/include/cryptopp/poly1305.h",
        "third_party/install/cryptopp/include/cryptopp/polynomi.h",
        "third_party/install/cryptopp/include/cryptopp/ppc_simd.h",
        "third_party/install/cryptopp/include/cryptopp/pssr.h",
        "third_party/install/cryptopp/include/cryptopp/pubkey.h",
        "third_party/install/cryptopp/include/cryptopp/pwdbased.h",
        "third_party/install/cryptopp/include/cryptopp/queue.h",
        "third_party/install/cryptopp/include/cryptopp/rabbit.h",
        "third_party/install/cryptopp/include/cryptopp/rabin.h",
        "third_party/install/cryptopp/include/cryptopp/randpool.h",
        "third_party/install/cryptopp/include/cryptopp/rc2.h",
        "third_party/install/cryptopp/include/cryptopp/rc5.h",
        "third_party/install/cryptopp/include/cryptopp/rc6.h",
        "third_party/install/cryptopp/include/cryptopp/rdrand.h",
        "third_party/install/cryptopp/include/cryptopp/resource.h",
        "third_party/install/cryptopp/include/cryptopp/rijndael.h",
        "third_party/install/cryptopp/include/cryptopp/ripemd.h",
        "third_party/install/cryptopp/include/cryptopp/rng.h",
        "third_party/install/cryptopp/include/cryptopp/rsa.h",
        "third_party/install/cryptopp/include/cryptopp/rw.h",
        "third_party/install/cryptopp/include/cryptopp/safer.h",
        "third_party/install/cryptopp/include/cryptopp/salsa.h",
        "third_party/install/cryptopp/include/cryptopp/scrypt.h",
        "third_party/install/cryptopp/include/cryptopp/seal.h",
        "third_party/install/cryptopp/include/cryptopp/secblock.h",
        "third_party/install/cryptopp/include/cryptopp/seckey.h",
        "third_party/install/cryptopp/include/cryptopp/seed.h",
        "third_party/install/cryptopp/include/cryptopp/serpent.h",
        "third_party/install/cryptopp/include/cryptopp/serpentp.h",
        "third_party/install/cryptopp/include/cryptopp/sha.h",
        "third_party/install/cryptopp/include/cryptopp/sha3.h",
        "third_party/install/cryptopp/include/cryptopp/shacal2.h",
        "third_party/install/cryptopp/include/cryptopp/shake.h",
        "third_party/install/cryptopp/include/cryptopp/shark.h",
        "third_party/install/cryptopp/include/cryptopp/simeck.h",
        "third_party/install/cryptopp/include/cryptopp/simon.h",
        "third_party/install/cryptopp/include/cryptopp/simple.h",
        "third_party/install/cryptopp/include/cryptopp/siphash.h",
        "third_party/install/cryptopp/include/cryptopp/skipjack.h",
        "third_party/install/cryptopp/include/cryptopp/sm3.h",
        "third_party/install/cryptopp/include/cryptopp/sm4.h",
        "third_party/install/cryptopp/include/cryptopp/smartptr.h",
        "third_party/install/cryptopp/include/cryptopp/sosemanuk.h",
        "third_party/install/cryptopp/include/cryptopp/speck.h",
        "third_party/install/cryptopp/include/cryptopp/square.h",
        "third_party/install/cryptopp/include/cryptopp/stdcpp.h",
        "third_party/install/cryptopp/include/cryptopp/strciphr.h",
        "third_party/install/cryptopp/include/cryptopp/tea.h",
        "third_party/install/cryptopp/include/cryptopp/threefish.h",
        "third_party/install/cryptopp/include/cryptopp/tiger.h",
        "third_party/install/cryptopp/include/cryptopp/trap.h",
        "third_party/install/cryptopp/include/cryptopp/trunhash.h",
        "third_party/install/cryptopp/include/cryptopp/ttmac.h",
        "third_party/install/cryptopp/include/cryptopp/tweetnacl.h",
        "third_party/install/cryptopp/include/cryptopp/twofish.h",
        "third_party/install/cryptopp/include/cryptopp/vmac.h",
        "third_party/install/cryptopp/include/cryptopp/wake.h",
        "third_party/install/cryptopp/include/cryptopp/whrlpool.h",
        "third_party/install/cryptopp/include/cryptopp/words.h",
        "third_party/install/cryptopp/include/cryptopp/xed25519.h",
        "third_party/install/cryptopp/include/cryptopp/xtr.h",
        "third_party/install/cryptopp/include/cryptopp/xtrcrypt.h",
        "third_party/install/cryptopp/include/cryptopp/zdeflate.h",
        "third_party/install/cryptopp/include/cryptopp/zinflate.h",
        "third_party/install/cryptopp/include/cryptopp/zlib.h",
    ],
    includes = ["third_party/install/cryptopp/include"],
)

#gflags
cc_library(
    name = "paddle_third_party_gflags",
    srcs = [
        "third_party/install/gflags/lib/libgflags.a",
    ],
    hdrs = [
        "third_party/install/gflags/include/gflags/gflags.h",
        "third_party/install/gflags/include/gflags/gflags_completions.h",
        "third_party/install/gflags/include/gflags/gflags_declare.h",
        "third_party/install/gflags/include/gflags/gflags_gflags.h",
    ],
    includes = ["third_party/install/gflags/include/"],
)

#glog
cc_library(
    name = "paddle_third_party_glog",
    srcs = [
        "third_party/install/glog/lib/libglog.a",
    ],
    hdrs = [
        "third_party/install/glog/include/glog/log_severity.h",
        "third_party/install/glog/include/glog/logging.h",
        "third_party/install/glog/include/glog/raw_logging.h",
        "third_party/install/glog/include/glog/stl_logging.h",
        "third_party/install/glog/include/glog/vlog_is_on.h",
    ],
    includes = ["third_party/install/glog/include"],
)

#xxhash
cc_library(
    name = "paddle_third_party_xxhash",
    srcs = [
        "third_party/install/xxhash/lib/libxxhash.a",
    ],
    hdrs = [
        "third_party/install/xxhash/include/xxhash.h",
    ],
    includes = ["third_party/install/xxhash/include"],
)

#utf8proc
cc_library(
    name = "paddle_third_party_utf8proc",
    srcs = [
        "third_party/install/utf8proc/lib/libutf8proc.a",
    ],
    hdrs = [
        "third_party/install/utf8proc/include/utf8proc.h",
    ],
    includes = ["third_party/install/utf8proc/include"],
)

#mkldnn
cc_import(
    name = "paddle_third_party_mkldnn_so",
    shared_library = "third_party/install/mkldnn/lib/libmkldnn.so.0",
    visibility = ["//visibility:private"],
)

cc_library(
    name = "paddle_third_party_mkldnn",
    hdrs = [
        "third_party/install/mkldnn/include/dnnl.h",
        "third_party/install/mkldnn/include/dnnl.hpp",
        "third_party/install/mkldnn/include/dnnl_config.h",
        "third_party/install/mkldnn/include/dnnl_debug.h",
        "third_party/install/mkldnn/include/dnnl_ocl.h",
        "third_party/install/mkldnn/include/dnnl_ocl.hpp",
        "third_party/install/mkldnn/include/dnnl_sycl.h",
        "third_party/install/mkldnn/include/dnnl_sycl.hpp",
        "third_party/install/mkldnn/include/dnnl_sycl_types.h",
        "third_party/install/mkldnn/include/dnnl_threadpool.h",
        "third_party/install/mkldnn/include/dnnl_threadpool.hpp",
        "third_party/install/mkldnn/include/dnnl_threadpool_iface.hpp",
        "third_party/install/mkldnn/include/dnnl_types.h",
        "third_party/install/mkldnn/include/dnnl_version.h",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl.h",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl.hpp",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_config.h",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_debug.h",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_ocl.h",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_ocl.hpp",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_ocl_types.h",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_sycl.h",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_sycl.hpp",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_sycl_types.h",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_threadpool.h",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_threadpool.hpp",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_threadpool_iface.hpp",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_types.h",
        "third_party/install/mkldnn/include/oneapi/dnnl/dnnl_version.h",
    ],
    includes = ["third_party/install/mkldnn/include"],
    deps = [
        ":paddle_third_party_mkldnn_so",
    ],
)

#mklml_intel
cc_import(
    name = "paddle_third_party_mklml_libiomp5.so",
    shared_library = "third_party/install/mklml/lib/libiomp5.so",
    visibility = ["//visibility:private"],
)

cc_import(
    name = "paddle_third_party_mklml_libmklml_intel.so",
    shared_library = "third_party/install/mklml/lib/libmklml_intel.so",
    visibility = ["//visibility:private"],
)

cc_library(
    name = "paddle_third_party_mklml_intel",
    hdrs = [
        "third_party/install/mklml/include/i_malloc.h",
        "third_party/install/mklml/include/mkl.h",
        "third_party/install/mklml/include/mkl_blas.h",
        "third_party/install/mklml/include/mkl_cblas.h",
        "third_party/install/mklml/include/mkl_direct_blas.h",
        "third_party/install/mklml/include/mkl_direct_blas_kernels.h",
        "third_party/install/mklml/include/mkl_direct_call.h",
        "third_party/install/mklml/include/mkl_direct_lapack.h",
        "third_party/install/mklml/include/mkl_direct_types.h",
        "third_party/install/mklml/include/mkl_dnn.h",
        "third_party/install/mklml/include/mkl_dnn_types.h",
        "third_party/install/mklml/include/mkl_lapack.h",
        "third_party/install/mklml/include/mkl_lapacke.h",
        "third_party/install/mklml/include/mkl_service.h",
        "third_party/install/mklml/include/mkl_spblas.h",
        "third_party/install/mklml/include/mkl_trans.h",
        "third_party/install/mklml/include/mkl_types.h",
        "third_party/install/mklml/include/mkl_version.h",
        "third_party/install/mklml/include/mkl_vml.h",
        "third_party/install/mklml/include/mkl_vml_defines.h",
        "third_party/install/mklml/include/mkl_vml_functions.h",
        "third_party/install/mklml/include/mkl_vml_types.h",
        "third_party/install/mklml/include/mkl_vsl.h",
        "third_party/install/mklml/include/mkl_vsl_defines.h",
        "third_party/install/mklml/include/mkl_vsl_functions.h",
        "third_party/install/mklml/include/mkl_vsl_types.h",
    ],
    includes = ["third_party/install/mklml/include"],
    deps = [
        ":paddle_third_party_mklml_libiomp5.so",
        ":paddle_third_party_mklml_libmklml_intel.so",
    ],
)

cc_library(
    name = "paddle_inference",
    linkopts = ["-lrt -ldl -lpthread"],
    deps = [
        ":paddle_inference-lib",
        ":paddle_third_party_cryptopp",
        ":paddle_third_party_gflags",
        ":paddle_third_party_glog",
        ":paddle_third_party_mkldnn",
        ":paddle_third_party_mklml_intel",
        ":paddle_third_party_utf8proc",
        ":paddle_third_party_xxhash",
        "@com_google_protobuf//:protobuf",
    ],
)
